#! /usr/bin/python

from get_nic import getnic
from subprocess import call
from subprocess import check_output as check 
from subprocess import CalledProcessError
from time import sleep
from os import name,system
from sys import exit

Interface = []

def space():
    print()

def update(): 
    system("cd /opt/WiFiPenTest && git pull")


def InterfaceDedection():
    if not Interface:
        interfaces = getnic.interfaces()
        getnic.ipaddr(interfaces)
        
        for i in interfaces:
                
                if i == "wlan0":
                    Interface.append("wlan0")
                    print("Interface : ",Interface[0])
                elif i == "wlan0mon":
                    Interface.append("wlan0mon")
                    print("Interface : ",Interface[0])
                    print("Monitor Mod Aktif !")
                elif i == "wlp2s0":             
                    Interface.append("wlp2s0")
                    print("Interface : ",Interface[0])

        if not Interface:
            interface = "İnterface Bulunamadı !"
            print("Interface Bulunamadı ! ")
    else:
        print("Interface : ",Interface[0])
        
def InterfaceChange():
    
    space()
    print("Interface : ",Interface[0])
    space()
    isItright = input("Interface doğru mu ? [E/h] : ")
    space()
    if isItright == "e" or isItright ==  "E":
        print("Evet seçildi devam ediliyor...")
        sleep(1)
        clean()
        Main()

    elif isItright == "h" or isItright ==  "H":
        interface = input("WiFi Interface giriniz : ")
        if interface == "":
            print("Lütfen Bir Interface giriniz ! ")
            InterfaceIsTrue()
        else:
            Interface.clear()
            Interface.append(interface)
            space()
            print("Interface Başarıyla değiştirildi ! ")
            space()
            print("Yeni Interface : ",interface)
            sleep(3)
            clean()
            Main()
        
    else:
        print("Lütfen doğru bir seçim yapınız !")
        sleep(2)
        InterfaceIsTrue()

def monitorMode():
    space()
    print("Sudo Şifresi İsteyebilir")
    space()
    output = check(["sudo","airmon-ng","start",Interface[0]])
    output = output.decode()
    output = output.split()
    output = output[::-1]
    space()
    if output[0] == "enabled)":
        print("Monitor Mod Aktif edildi ! ")
        sleep(3)
        clean()
        Main()
    else:
        print("Monitör Mod aktif edilemedi ! ")
        sleep(3)
        clean()
        Main()

def scanAround():
    pass
    

def scanNetwork():
    pass

def deauth():
    pass

def clean():
    if name == "nt":
        call(["cls"])
    else:
        call(["clear"])

def Exit():
    space()
    print("Çıkış Yapılıyor..")
    sleep(1)
    clean()
    print("Çıkış Yapıldı !")

def mainMenu():
    
    menu = """
    1) Monitor Modu Aktif Et
    2) Çevre WiFi Ağlarını Tara
    3) Belirli WiFi Ağına bağlı cihazları tara 
    4) Deauth - Yetkisizlendirme Saldırısı (Ağdan atar)

    10) Interface Değiştir (Algılanan Interface Yanlış ise)
    11) Güncelle 

    99) Exit
    """
    print(menu)
    choose = input("Choose : ")

    if choose == "1":
        monitorMode()
    elif choose == "2":
        scanAround()
    elif choose == "3":
        scanNetwork()
    elif choose == "10":
        InterfaceChange()
    elif choose == "11":
        update()
    elif choose == "99":
        Exit()
    
    else:
        clean()
        print("Lütfen doğru bir seçim yapınız !")
        sleep(2)
        clean()
        Main()

def banner():
    sleep(1)
    print("""
    --------------------------------------------
    Wifi Pentest Tool

    Author : Batuhan Türkarslan

    GitHub : https://.github.com/TURKZEN
    --------------------------------------------
    """)

def Main():

    banner()
    InterfaceDedection() 
    mainMenu()

if __name__ == "__main__":
    if name == "nt":
        print("Windows için henüz uygun değil !")
    else:
        try:
            Main()
        except KeyboardInterrupt:
            Exit()
        except EOFError:
            Exit()
        except CalledProcessError:
            
            print("""

            HATA !

            Interface'i kontrol et : {}

            Girilen Interface var olmayabilir,doğru olmayabilir 
            veya airmon-ng yüklü olmayabilir !
            """.format(Interface[0]))
            
            
        

